const s='<a :href="onboardingUrl" :class="classes" class="swag-paypal-onboarding-button" target="_paypal" :data-paypal-onboard-complete="callbackName" data-paypal-button="true" > <mt-loader v-if="isLoading" class="swag-paypal-onboarding-button__loader" size="20px" /> <slot> {{ buttonTitle }} </slot> </a>',n=Shopware.Component.wrapComponentConfig({template:s,inject:["acl","SwagPayPalSettingsService"],emits:["onboarded"],mixins:[Shopware.Mixin.getByName("swag-paypal-notification")],props:{mode:{type:String,required:!1,default:"live"},variant:{type:String,required:!1,default:"ghost"},disabled:{type:Boolean,required:!1,default:!1}},data(){return{type:this.mode,callbackId:Shopware.Utils.createId(),isLoading:!0,scriptId:"paypal-js",scriptURL:"https://www.paypal.com/webapps/merchantboarding/js/lib/lightbox/partner.js",live:{partnerId:"DYKPBPEAW5JNA",partnerClientId:"AR1aQ13lHxH1c6b3CDd8wSY6SWad2Lt5fv5WkNIZg-qChBoGNfHr2kT180otUmvE_xXtwkgahXUBBurW",sellerNonce:`${Shopware.Utils.createId()}${Shopware.Utils.createId()}`},sandbox:{partnerId:"45KXQA7PULGAG",partnerClientId:"AQ9g8qMYHpE8s028VCq_GO3Roy9pjeqGDjKTkR_sxzX0FtncBb3QUWbFtoQMtdpe2lG9NpnDT419dK8s",sellerNonce:`${Shopware.Utils.createId()}${Shopware.Utils.createId()}`},commonRequestParams:{channelId:"partner",product:"ppcp",secondaryProducts:"advanced_vaulting,PAYMENT_METHODS",capabilities:["APPLE_PAY","GOOGLE_PAY","PAY_UPON_INVOICE","PAYPAL_WALLET_VAULTING_ADVANCED"].join(","),integrationType:"FO",features:["PAYMENT","REFUND","READ_SELLER_DISPUTE","UPDATE_SELLER_DISPUTE","ADVANCED_TRANSACTIONS_SEARCH","ACCESS_MERCHANT_INFORMATION","TRACKING_SHIPMENT_READWRITE","VAULT","BILLING_AGREEMENT"].join(","),displayMode:"minibrowser",partnerLogoUrl:"https://assets.shopware.com/media/logos/shopware_logo_blue.svg"}}},watch:{mode(){this.type=this.mode},"$route.query"(t){Object.hasOwn(t,"ppOnboarding")&&this.completeOnboarding()}},computed:{settingsStore(){return Shopware.Store.get("swagPayPalSettings")},merchantInformationStore(){return Shopware.Store.get("swagPayPalMerchantInformation")},isSandbox(){return this.type==="sandbox"},suffix(){return this.isSandbox?"Sandbox":""},returnUrl(){return`${window.location.origin}${window.location.pathname}#${this.$route.path}?ppOnboarding=${this.type}`},requestParams(){return this.isSandbox?this.sandbox:this.live},onboardingUrl(){const t=new URL("/bizsignup/partner/entry",this.isSandbox?"https://www.sandbox.paypal.com":"https://www.paypal.com");return t.search=new URLSearchParams({...this.commonRequestParams,...this.requestParams,returnToPartnerUrl:this.returnUrl}).toString(),t.href},buttonTitle(){return this.settingsStore.get(`SwagPayPal.settings.clientSecret${this.suffix}`)?this.settingsStore.isSandbox===this.isSandbox&&!this.merchantInformationStore.canPPCP?this.$t(`swag-paypal-onboarding-button.${this.type}.onboardingTitle`):this.$t(`swag-paypal-onboarding-button.${this.type}.changeTitle`):this.$t(`swag-paypal-onboarding-button.${this.type}.title`)},callbackName(){return`onboardingCallback${this.callbackId}`},isDisabled(){return!this.acl.can("swag_paypal.editor")||this.isLoading||this.disabled},classes(){return{"is--sandbox":this.isSandbox,"is--live":!this.isSandbox,"is--link":this.variant==="link","is--ghost":this.variant==="ghost","is--disabled":this.isDisabled}}},mounted(){this.onMounted()},beforeUnmount(){delete window[this.callbackName]},methods:{onMounted(){this.acl.can("swag_paypal.editor")&&(Object.hasOwn(this.$route.query,"ppOnboarding")&&this.completeOnboarding(),window[this.callbackName]=(t,a)=>{this.fetchCredentials(t,a)},this.loadPayPalScript())},createScriptElement(){const t=document.createElement("script");return t.id=this.scriptId,t.type="text/javascript",t.src=this.scriptURL,t.async=!0,document.head.appendChild(t),t},loadPayPalScript(){const t=document.getElementById(this.scriptId)??this.createScriptElement();window.PAYPAL?(this.isLoading=!1,window.PAYPAL.apps.Signup.setup?window.PAYPAL.apps.Signup.setup():window.PAYPAL.apps.Signup.render()):t.addEventListener("load",()=>void this.renderPayPalButton(),!1)},async renderPayPalButton(){this.isLoading=!0,window.paypalScriptPromise||(window.PAYPAL.apps.Signup.render=function(){},window.paypalScriptPromise=this.waitForScriptsLoaded()),await window.paypalScriptPromise,this.isLoading=!1},waitForScriptsLoaded(){let t=0;const a=e=>{if(t>100)return e();if(window.PAYPAL.apps.Signup.render.name!=="proxyPPrender")return window.PAYPAL.apps.Signup.render(),e();if(window.PAYPAL.apps.Signup.setup)return e();t+=1,setTimeout(a.bind(this,e),300)};return new Promise(a.bind(this))},async fetchCredentials(t,a){if(this.isLoading)return;this.isLoading=!0;const e=await this.SwagPayPalSettingsService.getApiCredentials(t,a,this.requestParams.sellerNonce,this.isSandbox).catch(i=>(this.createNotificationError({title:this.$t("swag-paypal.notifications.credentials.title"),message:this.$t("swag-paypal.notifications.credentials.errorMessage",{message:this.createMessageFromError(i)})}),{}));this.setConfig(e.client_id,e.client_secret,e.payer_id),this.isLoading=!1},setConfig(t,a,e){this.settingsStore.set(`SwagPayPal.settings.clientId${this.suffix}`,t),this.settingsStore.set(`SwagPayPal.settings.clientSecret${this.suffix}`,a),this.settingsStore.set(`SwagPayPal.settings.merchantPayerId${this.suffix}`,e),this.merchantInformationStore.canPPCP||this.settingsStore.set("SwagPayPal.settings.sandbox",this.isSandbox),this.$emit("onboarded")},completeOnboarding(){const{ppOnboarding:t,merchantIdInPayPal:a}=this.$route.query;if(this.$router.replace({query:{}}),!a||t!=="sandbox"&&t!=="live")return;const e=t==="sandbox"?"Sandbox":"",i=String(a);this.settingsStore.set(`SwagPayPal.settings.merchantPayerId${e}`,i),this.$emit("onboarded")}}});export{n as default};
